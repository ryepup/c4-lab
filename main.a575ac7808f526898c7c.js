webpackJsonp([1],{125:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _index=__webpack_require__(604);Object.defineProperty(exports,"parse",{enumerable:!0,get:function(){return _index.parse}}),Object.defineProperty(exports,"ParseError",{enumerable:!0,get:function(){return _index.ParseError}});var _codegen=__webpack_require__(284);Object.defineProperty(exports,"uriEncode",{enumerable:!0,get:function(){return _codegen.uriEncode}}),Object.defineProperty(exports,"uriDecode",{enumerable:!0,get:function(){return _codegen.uriDecode}}),Object.defineProperty(exports,"toSvg",{enumerable:!0,get:function(){return _codegen.toSvg}});var _DataStore=__webpack_require__(614);Object.defineProperty(exports,"DataStore",{enumerable:!0,get:function(){return _DataStore.DataStore}});var _exporter=__webpack_require__(615);Object.defineProperty(exports,"Exporter",{enumerable:!0,get:function(){return _exporter.Exporter}}),Object.defineProperty(exports,"formats",{enumerable:!0,get:function(){return _exporter.formats}});var _dotWriter=__webpack_require__(616);Object.defineProperty(exports,"toDot",{enumerable:!0,get:function(){return _dotWriter.toDot}})},280:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}Object.defineProperty(exports,"__esModule",{value:!0});var _angular=__webpack_require__(42),_angular2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_angular),_nav=__webpack_require__(600),nav=_interopRequireWildcard(_nav),_about=__webpack_require__(285),about=_interopRequireWildcard(_about);exports.default=_angular2.default.module("c4-lab.header",["ui.bootstrap","ui.router"]).component(nav.name,nav.options).component(about.name,about.options).name},281:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _ParseError2=__webpack_require__(62),_ParseError3=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_ParseError2),InvalidDirectionError=function(_ParseError){function InvalidDirectionError(dir){return _classCallCheck(this,InvalidDirectionError),_possibleConstructorReturn(this,(InvalidDirectionError.__proto__||Object.getPrototypeOf(InvalidDirectionError)).call(this,'Unknown edge direction "'+dir+'". valid options are "push", "pull", or "both"'))}return _inherits(InvalidDirectionError,_ParseError),InvalidDirectionError}(_ParseError3.default);exports.default=InvalidDirectionError},282:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _ParseError2=__webpack_require__(62),_ParseError3=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_ParseError2),OptsNotFoundError=function(_ParseError){function OptsNotFoundError(type){return _classCallCheck(this,OptsNotFoundError),_possibleConstructorReturn(this,(OptsNotFoundError.__proto__||Object.getPrototypeOf(OptsNotFoundError)).call(this,"missing options for a "+type))}return _inherits(OptsNotFoundError,_ParseError),OptsNotFoundError}(_ParseError3.default);exports.default=OptsNotFoundError},283:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _ParseError2=__webpack_require__(62),_ParseError3=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_ParseError2),NameNotFoundError=function(_ParseError){function NameNotFoundError(type){return _classCallCheck(this,NameNotFoundError),_possibleConstructorReturn(this,(NameNotFoundError.__proto__||Object.getPrototypeOf(NameNotFoundError)).call(this,"missing a name for a "+type))}return _inherits(NameNotFoundError,_ParseError),NameNotFoundError}(_ParseError3.default);exports.default=NameNotFoundError},284:function(module,exports,__webpack_require__){"use strict";function toDataUrl(img,createElement){var canvas=createElement("canvas");canvas.width=img.width,canvas.height=img.height;var context=canvas.getContext("2d");if(context){context.drawImage(img,0,0);return canvas.toDataURL("image/png")}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.toPngDataUri=exports.uriDecode=exports.uriEncode=exports.toSvg=void 0;var _lzString=__webpack_require__(612),lz=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(_lzString),_viz=__webpack_require__(613),_viz2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_viz),toSvg=exports.toSvg=function(dot){return(0,_viz2.default)(dot,{format:"svg",engine:"dot"})};exports.uriEncode=function(text){return lz.compressToEncodedURIComponent(text)},exports.uriDecode=function(uriData){return lz.decompressFromEncodedURIComponent(uriData)},exports.toPngDataUri=function(dot,createElement){var svg=toSvg(dot),img=createElement("img");return new Promise(function(resolve){img.onload=function(){return resolve(toDataUrl(img,createElement))},img.setAttribute("src","data:image/svg+xml,"+encodeURIComponent(svg))})}},285:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.options=exports.name=void 0;var _about=__webpack_require__(621),_about2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_about);exports.name="c4LabAboutModal",exports.options={template:_about2.default,bindings:{close:"&"}}},286:function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}Object.defineProperty(exports,"__esModule",{value:!0});var _angular=__webpack_require__(42),angular=_interopRequireWildcard(_angular);__webpack_require__(250),__webpack_require__(251);var _viewer=__webpack_require__(631),viewer=_interopRequireWildcard(_viewer);exports.default=angular.module("c4-lab.viewer",["ui.bootstrap","ui.router"]).component(viewer.name,viewer.options).name},349:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function allowBlobsAndDataHrefs($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^(https?|ftp|mailto|blob|data):/i)}var _angular=__webpack_require__(42),angular=_interopRequireWildcard(_angular);__webpack_require__(351),__webpack_require__(553),__webpack_require__(250),__webpack_require__(251),__webpack_require__(583),__webpack_require__(585),__webpack_require__(587);var _angularticsGoogleAnalytics=__webpack_require__(589),_angularticsGoogleAnalytics2=_interopRequireDefault(_angularticsGoogleAnalytics),_editor=__webpack_require__(591),editor=_interopRequireWildcard(_editor),_header=__webpack_require__(280),_header2=_interopRequireDefault(_header),_shell=__webpack_require__(622),shell=_interopRequireWildcard(_shell),_buildInfo=__webpack_require__(625),buildInfo=_interopRequireWildcard(_buildInfo),_routes=__webpack_require__(627),_routes2=_interopRequireDefault(_routes),_preview=__webpack_require__(628),_preview2=_interopRequireDefault(_preview),_viewer=__webpack_require__(286),_viewer2=_interopRequireDefault(_viewer),_help=__webpack_require__(633),_help2=_interopRequireDefault(_help),_store=__webpack_require__(639),_store2=_interopRequireDefault(_store),_actions=__webpack_require__(47);angular.module("c4-lab",["ui.codemirror","ui.bootstrap","ui.router","ngAnimate","ngFileUpload",_angularticsGoogleAnalytics2.default,_header2.default,_preview2.default,_viewer2.default,_help2.default,_store2.default]).component(buildInfo.name,buildInfo.options).component(editor.name,editor.options).component(shell.name,shell.options).run(editor.install).config(allowBlobsAndDataHrefs).config(_routes2.default).run(function($state,$ngRedux,$window){$ngRedux.dispatch((0,_actions.angularInitialized)({$state:$state,$window:$window}))})},47:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.gistExport=exports.githubLogout=exports.githubLoginComplete=exports.githubLoggedIn=exports.zoomChanged=exports.angularInitialized=exports.svgChanged=exports.dotChanged=exports.sourceChanged=exports.sourceParseError=exports.sourceParsed=void 0;var _typescriptFsa=__webpack_require__(279),_typescriptFsa2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_typescriptFsa),actionCreator=(0,_typescriptFsa2.default)();exports.sourceParsed=actionCreator("C4_SOURCE_PARSED"),exports.sourceParseError=actionCreator("C4_SOURCE_PARSE_ERROR"),exports.sourceChanged=actionCreator("C4_SOURCE_CHANGED"),exports.dotChanged=actionCreator("C4_DOT_CHANGED"),exports.svgChanged=actionCreator("C4_SVG_CHANGED"),exports.angularInitialized=actionCreator("C4_ANGULAR_INITIALIZED"),exports.zoomChanged=actionCreator("C4_ZOOM_CHANGED"),exports.githubLoggedIn=actionCreator("C4_GITHUB_LOGGED_IN"),exports.githubLoginComplete=actionCreator("C4_GITHUB_LOGIN_COMPLETE"),exports.githubLogout=actionCreator("C4_GITHUB_LOGOUT"),exports.gistExport=actionCreator.async("C4_GIST_EXPORT")},591:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _editor=__webpack_require__(592);Object.keys(_editor).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _editor[key]}})})},592:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function install($window,$log){$log.debug("installing codemirror"),$window.CodeMirror=_codemirror2.default}Object.defineProperty(exports,"__esModule",{value:!0}),exports.options=exports.name=exports.EditorController=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.install=install,__webpack_require__(593),__webpack_require__(594),__webpack_require__(595),__webpack_require__(596),__webpack_require__(597);var _codemirror=__webpack_require__(124),_codemirror2=_interopRequireDefault(_codemirror),_editor=__webpack_require__(598),_editor2=_interopRequireDefault(_editor);__webpack_require__(599);var _actions=__webpack_require__(47),EditorController=exports.EditorController=function(){function EditorController($log,$ngRedux){"ngInject";_classCallCheck(this,EditorController),this.log=$log,this.editorOptions={lineNumbers:!0,mode:"commonlisp",theme:"elegant",matchBrackets:!0,autoCloseBrackets:!0},this.unsubscribe=$ngRedux.connect(this.mapStateToThis,{sourceChanged:_actions.sourceChanged})(this)}return _createClass(EditorController,[{key:"$onDestroy",value:function(){this.unsubscribe()}},{key:"mapStateToThis",value:function(state){return{text:state.source,parseError:state.parseError,syntaxIsValid:!state.parseError}}},{key:"parse",value:function(text){this.sourceChanged({source:text})}}]),EditorController}();exports.name="c4LabEditor",exports.options={template:_editor2.default,controller:EditorController}},598:function(module,exports){module.exports='<div ng-class="{\'bg-success\': $ctrl.syntaxIsValid, \'bg-danger\': !$ctrl.syntaxIsValid}" style="padding: 0 1em;">\n    <ui-codemirror ui-codemirror-opts="$ctrl.editorOptions" ng-model="$ctrl.text" ng-model-options="{ debounce: 250 }"\n        ng-change="$ctrl.parse($ctrl.text)">\n    </ui-codemirror>\n    <span class="help-block">{{ $ctrl.parseError }}</span>\n</div>'},599:function(module,exports){},600:function(module,exports,__webpack_require__){"use strict";(function(process){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.options=exports.name=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_nav=__webpack_require__(601),_nav2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_nav);__webpack_require__(603);var _index=__webpack_require__(125),_importer=__webpack_require__(620),_about=__webpack_require__(285),aboutComponent=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(_about),_actions=__webpack_require__(47),githubLoginPopupUrl=process.env.C4_GITHUB_LOGIN_POPUP_URL||"https://c4-lab.azurewebsites.net/api/GithubLogin?code=CZiBo89DKe5LcWUHYtYqQYkTZUU1OmLsIXOFxmBfLaL3HmVXVTCbkg==",NavController=function(){function NavController($state,$uibModal,$ngRedux,$window){"ngInject";_classCallCheck(this,NavController),this.$state=$state,this.$uibModal=$uibModal,this.exportFormats=_index.formats,this.$window=$window,this.unsubscribe=$ngRedux.connect(this.mapStateToThis,{sourceChanged:_actions.sourceChanged,githubLoggedIn:_actions.githubLoggedIn,githubLogout:_actions.githubLogout,gistExport:_actions.gistExport.started})(this)}return _createClass(NavController,[{key:"$onDestroy",value:function(){this.unsubscribe()}},{key:"mapStateToThis",value:function(state){return{text:state.source,zoom:state.zoomNodeId,user:state.user}}},{key:"href",value:function(zoom){return this.$state.href("load",{data:(0,_index.uriEncode)(this.text),zoom:zoom})}},{key:"export",value:function(format){var href=this.href();"gist"===format?this.gistExport({href:href}):this.onExport({format:format,href:href})}},{key:"import",value:function(files){var _this=this;files&&(0,_importer.readAllText)(files[0]).then(function(text){return _this._onImport(text)})}},{key:"openAbout",value:function(){this.$uibModal.open({component:aboutComponent.name})}},{key:"_onImport",value:function(text){this.sourceChanged({source:text})}},{key:"login",value:function(){var _this2=this,expectedOrigin=new URL(githubLoginPopupUrl).origin;this.$window.open(githubLoginPopupUrl,"Github authentication"),this.$window.addEventListener("message",function(event){event.origin===expectedOrigin&&_this2.githubLoggedIn({token:event.data.payload.token})},{capture:!1,once:!0})}}]),NavController}();exports.name="c4LabNav",exports.options={template:_nav2.default,controller:NavController,bindings:{onExport:"&"}}}).call(exports,__webpack_require__(23))},601:function(module,exports,__webpack_require__){module.exports='<nav class="navbar navbar-default">\n    <div class="container-fluid">\n        <div class="navbar-header">\n            <a class="navbar-brand" href="#">C4 Lab</a>\n        </div>\n\n        <p class="navbar-text navbar-right c4lab-build">\n            <c4-lab-build-info></c4-lab-build-info>\n        </p>\n\n        <div class="navbar-collapse collapse">\n            <ul class="nav navbar-nav">\n                <li>\n                    <a popover-placement="bottom" uib-popover-template="\'_share.html\'" analytics-on="click"\n                        analytics-event="share">\n                        <span class="glyphicon glyphicon-duplicate"> </span> Share\n                    </a>\n                </li>\n                <li>\n                    <a ngf-select="$ctrl.import($files)" ngf-pattern="\'.sexp\'" ngf-accept="\'.sexp\'" analytics-on="click"\n                        analytics-event="import">\n                        <span class="glyphicon glyphicon-open-file"> </span> Import\n                    </a>\n                </li>\n                <li class="dropdown" uib-dropdown>\n                    <a uib-dropdown-toggle>\n                        <span class="glyphicon glyphicon-picture"> </span> Export <span class="caret"></span>\n                    </a>\n                    <ul id="export-format-list" class="dropdown-menu" uib-dropdown-menu>\n                        <li ng-repeat="format in $ctrl.exportFormats">\n                            <a ng-click="$ctrl.export(format)" analytics-on="click" analytics-event="export"\n                                analytics-label="{{format}}">{{format}}</a>\n                        </li>\n                        <li ng-if="$ctrl.user">\n                            <a ng-click="$ctrl.export(\'gist\')" analytics-on="click" analytics-event="export"\n                                analytics-label="gist">GitHub Private Gist&nbsp;<img src="'+__webpack_require__(602)+'"></a>\n                        </li>\n                    </ul>\n                </li>\n                <li>\n                    \x3c!-- TODO: make this a modal route--\x3e\n                    <a href="#" ng-click="$ctrl.openAbout()" analytics-on="click" analytics-event="about">\n                        <span class="glyphicon glyphicon-info-sign"> </span> About\n                    </a>\n                </li>\n                <li>\n                    <a ui-sref="help">\n                        <span class="glyphicon glyphicon-question-sign"> </span> Help\n                    </a>\n                </li>\n                <p class="navbar-text" ng-if="$ctrl.user">\n                    <img ng-src="{{$ctrl.user.avatarUrl}}" height=20 class="img-circle">\n                    {{$ctrl.user.login}}\n                    <a href="#" class="navbar-link" ng-click="$ctrl.githubLogout()">Logout</a>\n                </p>\n                <li ng-if="!$ctrl.user">\n                    <a href="#" ng-click="$ctrl.login()">\n                        Login with Github\n                    </a>\n                </li>\n            </ul>\n        </div>\n    </div>\n</nav>\n\n<script type="text/ng-template" id="_share.html">\n    <div style="width:10em;">\n        <a ng-href="{{$ctrl.href($ctrl.zoom)}}" target="_blank">\n            <span class="glyphicon glyphicon-new-window" > </span>\n            Link to this page</a>\n    </div>\n<\/script>'},602:function(module,exports){module.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFNTE3OEEyQTk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFNTE3OEEyQjk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU1MTc4QTI4OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU1MTc4QTI5OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+m4QGuQAAAyRJREFUeNrEl21ojWEYx895TDPbMNlBK46IUiNmPvHBSUjaqc0H8pF5+aDUKPEBqU2NhRQpX5Rv5jWlDIWlMCv7MMSWsWwmb3tpXub4XXWdPHvc9/Gc41nu+nedc7/8r/99PffLdYdDPsvkwsgkTBwsA/PADJCnzX2gHTwBt8Hl7p537/3whn04XoDZDcpBlk+9P8AFcAghzRkJwPF4zGGw0Y9QS0mAM2AnQj77FqCzrtcwB1Hk81SYojHK4DyGuQ6mhIIrBWB9Xm7ug/6B/nZrBHBegrkFxoVGpnwBMSLR9EcEcC4qb8pP14BWcBcUgewMnF3T34VqhWMFkThLJAalwnENOAKiHpJq1FZgI2AT6HZtuxZwR9GidSHtI30jOrbawxlVX78/AbNfhHlomEUJJI89O2MqeE79T8/nk8nMBm/dK576hZgmA3cp/R4l9/UeSxiHLVIlNm4nFfT0bxyuIj7LHRTKai+zdJobwMKzcZSJb0ePV5PKN+BqAAKE47UlMnERELMM3EdYP/yrd+XYb2mOiYBiQ8OQnoRBlXrl9JZix7D1pHTazu4MoyBcnYamqAjIMTR8G4FT8LuhLsexXYYjICBiqhQBvYb6fLZIJCjPypVvaOoVAW2WcasCnL2Nq82xHJNSqlCeFcDshaPK0twkAhosjZL31QYw+1rlMpWGMArl23SBsZZO58F2tlJXmjOXS+s4WGvpMiBJT/I2PInZ6lIs9/hBsNS1hS6BG0DSqmYEDRlCXQrmy50P1oDRKTSegmNbUsA0zDMwRhPJXeCE3vWLPQMvan6X8AgIa1vcR4AkGZkDR4ejJ1UHpsaVI0g2LInpOsNFUud1rhxSV+fzC9Woz2EZkWQuja7/B+jUrgtIMpy9YCW4n4K41YfzRneW5E1KJTe4B2Zq1Q5EHEtj4U3AfEzR5SVY4l7QYQPJdN2as7RKBF0BPZqqH4VgMAMBL8Byxr7y8zCZiDlnOcEKIPmUpgB5Z2ww5RdOiiRiNajUmWda5IG6WbhsyY2fx6m8gLcoJDJFkH219M3We1+cnda93pfycZpIJEL/s/wSYADmOAwAQgdpBAAAAABJRU5ErkJggg=="},603:function(module,exports){},604:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=exports.NameNotFoundError=exports.OptsNotFoundError=exports.InvalidDirectionError=exports.ParseError=void 0;var _ParseError=__webpack_require__(62);Object.defineProperty(exports,"ParseError",{enumerable:!0,get:function(){return _interopRequireDefault(_ParseError).default}});var _InvalidDirectionError=__webpack_require__(281);Object.defineProperty(exports,"InvalidDirectionError",{enumerable:!0,get:function(){return _interopRequireDefault(_InvalidDirectionError).default}});var _OptsNotFoundError=__webpack_require__(282);Object.defineProperty(exports,"OptsNotFoundError",{enumerable:!0,get:function(){return _interopRequireDefault(_OptsNotFoundError).default}});var _NameNotFoundError=__webpack_require__(283);Object.defineProperty(exports,"NameNotFoundError",{enumerable:!0,get:function(){return _interopRequireDefault(_NameNotFoundError).default}});var _Parser=__webpack_require__(605);exports.parse=function(text){return(new _Parser.Parser).parse(text)}},605:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr)}function isString(x){return x&&"string"===x.type}function isList(x){return x&&"list"===x.type}function isAtom(x){return x&&"atom"===x.type}function canonicalize(key){return keywordAliases.filter(function(_ref){return _ref.from.test(key)}).map(function(_ref2){return _ref2.to})[0]||key}function parseKeywordArgs(kwargs){var allowed=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/.*/;if(0===kwargs.length)return{};var _kwargs=_toArray(kwargs),keyword=_kwargs[0],value=_kwargs[1],rest=_kwargs.slice(2);if(!isAtom(keyword))throw new Error("Expected keyword to be an atom");if(!isString(value))throw new Error("Expected value to be a string");var key=canonicalize(keyword.content);return Object.assign(allowed.test(key)?_defineProperty({},key,value.content):{},parseKeywordArgs(rest,allowed))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Parser=exports.pathToId=void 0;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_path=__webpack_require__(606),path=_interopRequireWildcard(_path),_sexprPlus=__webpack_require__(607),sexp=_interopRequireWildcard(_sexprPlus),_md=__webpack_require__(608),_interfaces=__webpack_require__(609),_InvalidDirectionError=__webpack_require__(281),_InvalidDirectionError2=_interopRequireDefault(_InvalidDirectionError),_NameNotFoundError=__webpack_require__(283),_NameNotFoundError2=_interopRequireDefault(_NameNotFoundError),_OptsNotFoundError=__webpack_require__(282),_OptsNotFoundError2=_interopRequireDefault(_OptsNotFoundError),_ParseError=__webpack_require__(62),_ParseError2=_interopRequireDefault(_ParseError),_TitleNotAStringError=__webpack_require__(610),_TitleNotAStringError2=_interopRequireDefault(_TitleNotAStringError),_TitleNotAtTopLevelError=__webpack_require__(611),_TitleNotAtTopLevelError2=_interopRequireDefault(_TitleNotAtTopLevelError),pathToId=exports.pathToId=function(p){return _md.Md5.hashStr(p,!1)},keywordAliases=[{from:/^:desc.*/i,to:"description"},{from:/^:to/i,to:"to"},{from:/^:tech/i,to:"tech"},{from:/^:dir.*/i,to:"direction"}];exports.Parser=function(){function Parser(){_classCallCheck(this,Parser),this.graphTitle="",this.idMap={},this.pathMap={},this.edges=[],this.items=[]}return _createClass(Parser,[{key:"parse",value:function(text){var tokens=sexp.parse(text);this.buildIR(tokens);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.edges[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var e=_step.value;this.postProcessEdge(e)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return{edges:this.edges,idMap:this.idMap,items:this.items,pathMap:this.pathMap,roots:this.items.filter(function(x){return!x.parentId}).map(function(x){return x.id}),title:this.graphTitle}}},{key:"buildIR",value:function(tokens,parent){var _this=this;return tokens.map(function(x){return _this.buildIRNode(x,parent)})}},{key:"buildIRNode",value:function(token,parent){if(!isList(token))throw new Error("bare string not permitted");var _token$content=_toArray(token.content),head=_token$content[0],tail=_token$content.slice(1);if(!isAtom(head))throw new Error("expected atom, found "+head.type);var node=this._buildIRNode(head.content,tail,parent);return node?((0,_interfaces.isEdge)(node)||node.children.every(_interfaces.isEdge)||(node.canExpand=!0),node):null}},{key:"_buildIRNode",value:function(head,tail,parent){var type=head.replace(/^def(ine)?-/i,"").toLowerCase().trim();switch(type){case"edge":return this.edge(tail,parent);case"title":return this.title(tail,parent),null;default:return this.item(type,tail,parent)}}},{key:"item",value:function(type,tokens,parent){var _tokens=_toArray(tokens),opts=_tokens[0],children=_tokens.slice(1);if(!isList(opts))throw new _OptsNotFoundError2.default(type);var _opts$content=_toArray(opts.content),name=_opts$content[0],kwargs=_opts$content.slice(1);if(!isString(name)||""===name.content)throw new _NameNotFoundError2.default(type);var p=this.pathToNode(name.content,parent).toString(),node={children:[],id:pathToId(p),name:name.content,path:p,type:type};parent&&(node.parentId=parent.id),this.idMap[node.id]=node,this.pathMap[node.path]=node.id,Object.assign(node,parseKeywordArgs(kwargs,/description|tech/)),this.items.push(node);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this.buildIR(children,node)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var n=_step2.value;n&&node.children.push(n)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return node}},{key:"edge",value:function(kwargs,parent){if(!parent)throw new Error("edge at top level?");var edge=Object.assign({sourceId:parent.id,type:"edge"},parseKeywordArgs(kwargs,/description|to|tech|direction/));return this.edges.push(edge),edge}},{key:"title",value:function(_ref4,parent){var _ref5=_slicedToArray(_ref4,1),input=_ref5[0];if(!isString(input))throw new _TitleNotAStringError2.default(input.toString());if(parent)throw new _TitleNotAtTopLevelError2.default;this.graphTitle=input.content}},{key:"pathToNode",value:function(name,parent){return parent?this.idMap[parent.id].path+"/"+name:name}},{key:"postProcessEdge",value:function(edge){if(edge.to.startsWith(".")){var src=this.idMap[edge.sourceId];if(!src.parentId)throw new Error("relative paths have to have a parent");var parent=this.idMap[src.parentId];edge.to=path.join(parent.path,edge.to)}if(edge.destinationId=this.pathMap[edge.to],!edge.destinationId)throw new _ParseError2.default("Could not find node '"+edge.to+"'");if(edge.sourceId===edge.destinationId)throw new _ParseError2.default("Edge cannot be both from and to '"+edge.to+"'");if(edge.direction){if(!/^(push|pull|both)$/i.test(edge.direction))throw new _InvalidDirectionError2.default(edge.direction);edge.direction=edge.direction.toLowerCase()}edge.id=pathToId(edge.sourceId+edge.destinationId),edge.sourceParentIds=this.findParentIds(edge.sourceId),edge.destinationParentIds=this.findParentIds(edge.destinationId)}},{key:"findParentIds",value:function(id){var node=this.idMap[id];return node.parentId?[node.parentId].concat(this.findParentIds(node.parentId)):[]}}]),Parser}()},609:function(module,exports,__webpack_require__){"use strict";function isEdge(x){return"edge"===x.type}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isEdge=isEdge},610:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _ParseError2=__webpack_require__(62),_ParseError3=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_ParseError2),TitleNotAStringError=function(_ParseError){function TitleNotAStringError(input){return _classCallCheck(this,TitleNotAStringError),_possibleConstructorReturn(this,(TitleNotAStringError.__proto__||Object.getPrototypeOf(TitleNotAStringError)).call(this,"title must be a string, was: "+JSON.stringify(input)))}return _inherits(TitleNotAStringError,_ParseError),TitleNotAStringError}(_ParseError3.default);exports.default=TitleNotAStringError},611:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _ParseError2=__webpack_require__(62),_ParseError3=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_ParseError2),TitleNotAtTopLevelError=function(_ParseError){function TitleNotAtTopLevelError(){return _classCallCheck(this,TitleNotAtTopLevelError),_possibleConstructorReturn(this,(TitleNotAtTopLevelError.__proto__||Object.getPrototypeOf(TitleNotAtTopLevelError)).call(this,"title is only allowed at the top level"))}return _inherits(TitleNotAtTopLevelError,_ParseError),TitleNotAtTopLevelError}(_ParseError3.default);exports.default=TitleNotAtTopLevelError},614:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.DataStore=function(){function DataStore(localStorage){_classCallCheck(this,DataStore),this.localStorage=localStorage}return _createClass(DataStore,[{key:"load",value:function(){return this.localStorage.getItem("C4-LAB-ACTIVE-DOC-VNEXT")}},{key:"save",value:function(text){this.localStorage.setItem("C4-LAB-ACTIVE-DOC-VNEXT",text)}}]),DataStore}()},615:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Exporter=exports.formats=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_codegen=__webpack_require__(284),Exporter=(exports.formats="sexp dot png".split(" "),function(){function Exporter(document){_classCallCheck(this,Exporter),this.createElement=function(e){return document.createElement(e)}}return _createClass(Exporter,[{key:"export",value:function(format,title,text,dot){var safeTitle=title||"c4-lab-graph";switch(format){case"sexp":return this.sexp(safeTitle,text);case"dot":return this.dot(safeTitle,dot);case"png":return this.png(safeTitle,dot);default:throw new Error("unknown format: "+format)}}},{key:"sexp",value:function(title,text){this.downloadFile(title+".sexp",text,"text/plain")}},{key:"dot",value:function(title,_dot){this.downloadFile(title+".dot",_dot,"text/plain")}},{key:"png",value:function(title,dot){var _this=this;(0,_codegen.toPngDataUri)(dot,this.createElement).then(function(dataUri){return _this.downloadFile(title+".png",dataUri)})}},{key:"downloadFile",value:function(filename,content,contentType){var a=this.createElement("a");a.download=filename,a.href=contentType?"data:"+contentType+","+encodeURIComponent(content):content,a.click()}}]),Exporter}());exports.Exporter=Exporter},616:function(module,exports,__webpack_require__){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.toDot=exports.DotContext=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(617),_wordwrap=__webpack_require__(618),wordwrap=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(_wordwrap),_DOT=__webpack_require__(619),typeShapeMap={actor:"egg",component:"component",container:"box3d"},DotContext=exports.DotContext=function(){function DotContext(hrefTo){_classCallCheck(this,DotContext),this.visibleIds=[],this.visibleEdges=[],this.wordwrap=wordwrap.soft(0,30),this.hrefTo=hrefTo}return _createClass(DotContext,[{key:"load",value:function(graph,zoomNodeId){var _this=this;this.graph=graph,this.zoomNodeId=zoomNodeId,this.visibleIds=zoomNodeId?this.findVisibleNodes(zoomNodeId):graph.roots,this.visibleIds.sort(),this.visibleEdges=graph.edges.filter(function(x){return _this.isEdgeVisible(x)})}},{key:"draw",value:function(){return[].concat(_toConsumableArray(this._draw())).join("\n")}},{key:"_draw",value:regeneratorRuntime.mark(function _draw(){var _this2=this;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,"digraph g {";case 2:return _context.delegateYield(this.digraphHeaders("  "),"t0",3);case 3:if(!this.rootNode){_context.next=11;break}if(!this.rootNode.parentId){_context.next=8;break}return _context.delegateYield(this.drawChildCluster("  ",this.rootNode.parentId),"t1",6);case 6:_context.next=9;break;case 8:return _context.delegateYield(this.drawCluster("  ",this.rootNode),"t2",9);case 9:_context.next=12;break;case 11:return _context.delegateYield(this.drawItems(this.visibleIds,"  "),"t3",12);case 12:return _context.next=14,"";case 14:return _context.delegateYield(this.visibleEdges.map(function(x){return _this2.drawEdge(x,"  ")}),"t4",15);case 15:return _context.next=17,"}";case 17:return _context.next=19,"";case 19:case"end":return _context.stop()}},_draw,this)})},{key:"findVisibleNodes",value:function(zoomNodeId){if(!this.graph)throw new Error("must have a graph");this.rootNode=this.graph.idMap[zoomNodeId];var visibleNodes=this.rootNode.children.concat([this.rootNode]);if(this.rootNode.parentId){var parent=this.graph.idMap[this.rootNode.parentId];visibleNodes=visibleNodes.concat(parent.children),visibleNodes.push(parent)}var visibleIds=visibleNodes.map(function(x){return x.id}).concat(this.graph.roots).filter(function(x){return x});return(0,_lodash.uniq)(visibleIds)}},{key:"toDotId",value:function(nodeOrId){var id=(0,_lodash.isString)(nodeOrId)?nodeOrId:nodeOrId.id;return"g"+this.visibleIds.indexOf(id)}},{key:"toDescription",value:function(nodeOrText){var htmlNewlines=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],text=(0,_lodash.isString)(nodeOrText)?nodeOrText:nodeOrText.description;if(!text)return"";var wrapped=this.wordwrap(text);return htmlNewlines?wrapped.replace(/\n/g,"<br/>\n"):wrapped}},{key:"toLabel",value:function(edgeOrText){return this.toDescription(edgeOrText,!1).replace(/"/g,'\\"').replace(/\n/g,"\\n")}},{key:"isEdgeVisible",value:function(edge){return this.isIdVisible(edge.sourceId)||this.isIdVisible(edge.destinationId)||this.isCrossingSystems(edge)}},{key:"isCrossingSystems",value:function(edge){var visibleSourceIds=this.findVisibleIds(edge.sourceParentIds),visibleDestinationIds=this.findVisibleIds(edge.destinationParentIds);return visibleSourceIds[0]!==visibleDestinationIds[0]}},{key:"findVisibleIds",value:function(ids){var _this3=this;return ids.filter(function(x){return _this3.isIdVisible(x)})}},{key:"isIdVisible",value:function(id){return this.visibleIds.includes(id)}},{key:"drawCluster",value:regeneratorRuntime.mark(function drawCluster(indent,rootNode){var dotId,label,nonClustered,style=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rounded";return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(this.graph){_context2.next=2;break}throw new Error("must have a graph");case 2:dotId=this.toDotId(rootNode),label=this.toLabel(rootNode.name),_context2.next=7;break;case 7:return _context2.next=9,indent+"subgraph cluster_"+dotId+" {\n"+indent+"  label=<"+_DOT.DOT.b(label)+'> style="'+style+'"';case 9:return _context2.next=11,"";case 11:return _context2.next=13,indent+"  "+dotId+' [style="invisible"]';case 13:return _context2.next=15,"";case 15:return _context2.delegateYield(this.drawItems(rootNode.children,indent+"  "),"t0",16);case 16:return _context2.next=18,indent+"}";case 18:if(rootNode.parentId){_context2.next=21;break}return nonClustered=this.graph.roots.filter(function(x){return x!==rootNode.id}).filter(function(x){return x!==rootNode.parentId}),_context2.delegateYield(this.drawItems(nonClustered,indent),"t1",21);case 21:_context2.next=24;break;case 24:case"end":return _context2.stop()}},drawCluster,this)})},{key:"drawChildCluster",value:regeneratorRuntime.mark(function drawChildCluster(indent,parentId){var parent,dotId,label,nonClustered,otherChildren,nextIndent,_this4=this;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(this.graph){_context3.next=2;break}throw new Error("must have a graph");case 2:if(this.rootNode){_context3.next=4;break}throw new Error("must have a rootNode");case 4:parent=this.graph.idMap[parentId],dotId=this.toDotId(parent),label=this.toLabel(parent.name),nonClustered=this.graph.roots.filter(function(x){return x!==parent.id}),otherChildren=parent.children.filter(function(x){return x!==_this4.rootNode}),nextIndent=indent+"  ",_context3.next=13;break;case 13:return _context3.next=15,indent+"subgraph cluster_"+dotId+" {";case 15:return _context3.next=17,nextIndent+"label=<"+_DOT.DOT.b(label)+'> style="rounded"';case 17:return _context3.next=19,"";case 19:return _context3.next=21,""+nextIndent+dotId+' [style="invisible"]';case 21:return _context3.delegateYield(this.drawItems(otherChildren,nextIndent),"t0",22);case 22:return _context3.next=24,"";case 24:return _context3.delegateYield(this.drawCluster(nextIndent,this.rootNode,"solid"),"t1",25);case 25:return _context3.next=27,indent+"}";case 27:return _context3.delegateYield(this.drawItems(nonClustered,indent),"t2",28);case 28:_context3.next=31;break;case 31:case"end":return _context3.stop()}},drawChildCluster,this)})},{key:"digraphHeaders",value:regeneratorRuntime.mark(function digraphHeaders(indent){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(this.graph){_context4.next=2;break}throw new Error("must have a graph");case 2:return _context4.next=4,indent+"compound=true";case 4:if(!this.graph.title){_context4.next=11;break}return _context4.next=7,indent+'label="'+this.toLabel(this.graph.title)+'"';case 7:return _context4.next=9,indent+"fontsize=20";case 9:return _context4.next=11,indent+"labelloc=t";case 11:return _context4.next=13,indent+"node[fontsize=12]";case 13:return _context4.next=15,indent+"edge[fontsize=12]";case 15:return _context4.next=17,"";case 17:case"end":return _context4.stop()}},digraphHeaders,this)})},{key:"toTechDescription",value:function(text){return text?(text=this.toDescription(text),"\n<br/>\n"+(text=_DOT.DOT.font("#666666",_DOT.DOT.i("&#171;"+text+"&#187;")))+"\n<br/>"):""}},{key:"drawItems",value:regeneratorRuntime.mark(function drawItems(nodesOrIds,indent){var idMap,_this5=this;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(this.graph){_context5.next=2;break}throw new Error("must have a graph");case 2:idMap=this.graph.idMap,_context5.next=6;break;case 6:return _context5.delegateYield(nodesOrIds.map(function(x){return(0,_lodash.isString)(x)?idMap[x]:x}).filter(function(x){return"edge"!==x.type}).map(function(x){return _this5.drawItem(x,indent)}),"t0",7);case 7:_context5.next=10;break;case 10:case"end":return _context5.stop()}},drawItems,this)})},{key:"drawItem",value:function(node,indent){var dotId=this.toDotId(node),tech=this.toTechDescription(node.tech),desc=node.description?"\n<br/>\n"+this.toDescription(node):"",shape=typeShapeMap[node.type]||"box",attrs={shape:shape},name=_DOT.DOT.b(node.name);return this.hrefTo&&node.children&&node.children.some(function(x){return"edge"!==x.type})&&(attrs.href=this.hrefTo(node.id),attrs.tooltip="See more details about "+node.name,name=_DOT.DOT.font("blue",_DOT.DOT.u(name))),attrs.label="<\n"+name+tech+desc+"\n"+indent+">",""+indent+dotId+" "+_DOT.DOT.attrList(attrs)}},{key:"drawEdge",value:function(edge,indent){var _this6=this,srcOk=this.isIdVisible(edge.sourceId),dstOk=this.isIdVisible(edge.destinationId),getId=function(idOk,id,parentIds){var result=idOk?id:parentIds.find(function(x){return _this6.isIdVisible(x)});if(result)return result;throw new Error("Unknown id")},srcId=getId(srcOk,edge.sourceId,edge.sourceParentIds),dstId=getId(dstOk,edge.destinationId,edge.destinationParentIds),src=this.toDotId(srcId),dst=this.toDotId(dstId),attrs={};return edge.description&&(attrs.label=this.toLabel(edge)),srcOk&&dstOk||(attrs.style="dashed"),srcId===this.zoomNodeId&&(attrs.ltail="cluster_"+src),dstId===this.zoomNodeId&&(attrs.lhead="cluster_"+dst),attrs.dir=this.getEdgeDirection(edge.direction),""+indent+src+" -> "+dst+" "+_DOT.DOT.attrList(attrs)}},{key:"getEdgeDirection",value:function(direction){switch(direction){case"both":return"both";case"pull":return"back";default:return null}}}]),DotContext}();exports.toDot=function(graph,zoomNodeId,hrefTo){var ctx=new DotContext(hrefTo);return ctx.load(graph,zoomNodeId),ctx.draw()}},619:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.DOT=function(){function DOT(){_classCallCheck(this,DOT)}return _createClass(DOT,null,[{key:"i",value:function(text){return"<i>"+text+"</i>"}},{key:"b",value:function(text){return"<b>"+text+"</b>"}},{key:"u",value:function(text){return"<u>"+text+"</u>"}},{key:"font",value:function(color,text){return'<font color="'+color+'">'+text+"</font>"}},{key:"attrList",value:function(attrs){return"["+Reflect.ownKeys(attrs).filter(function(x){return attrs[x]}).map(function(x){return String(x)+"="+DOT.quoteAttr(attrs[x])}).join(" ")+"]"}},{key:"quoteAttr",value:function(value){return/^</.test(value)?value:'"'+value+'"'}}]),DOT}()},62:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var ParseError=function(_extendableBuiltin2){function ParseError(){return _classCallCheck(this,ParseError),_possibleConstructorReturn(this,(ParseError.__proto__||Object.getPrototypeOf(ParseError)).apply(this,arguments))}return _inherits(ParseError,_extendableBuiltin2),ParseError}(function(cls){function ExtendableBuiltin(){var instance=Reflect.construct(cls,Array.from(arguments));return Object.setPrototypeOf(instance,Object.getPrototypeOf(this)),instance}return ExtendableBuiltin.prototype=Object.create(cls.prototype,{constructor:{value:cls,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(ExtendableBuiltin,cls):ExtendableBuiltin.__proto__=cls,ExtendableBuiltin}(Error));exports.default=ParseError},620:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.readAllText=function(file){var reader=new FileReader;return new Promise(function(resolve,reject){reader.onload=function(loadEvt){return resolve(loadEvt.target.result)},reader.onerror=reject,reader.readAsText(file)})}},621:function(module,exports){module.exports='<div class="modal-header">\n    <h3 class="modal-title" id="modal-title">About</h3>\n</div>\n<div class="modal-body" id="modal-body">\n    <p>C4 Lab helps to create diagrams expressing a software architecture using a small lisp-like language, and share those\n        diagrams as images or text.\n    </p>\n    <p>\n        This is a based on <a href="http://www.simonbrown.je/">Simon Brown</a>\'s <a href="http://www.codingthearchitecture.com/2014/08/24/c4_model_poster.html">C4</a>        approach: Context, Containers, Components, and Classes. See <a href="https://leanpub.com/visualising-software-architecture">Visualising Software Architecture</a>        for more information.\n    </p>\n    <p>\n        If you have any feedback or problems, please open a <a href="https://github.com/ryepup/c4-lab/issues">issue on github</a>.\n    </p>\n    <c4-lab-build-info></c4-lab-build-info>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-primary" type="button" ng-click="$ctrl.close()">Close</button>\n</div>'},622:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _app=__webpack_require__(623);Object.keys(_app).forEach(function(key){"default"!==key&&"__esModule"!==key&&Object.defineProperty(exports,key,{enumerable:!0,get:function(){return _app[key]}})})},623:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.options=exports.name=exports.AppController=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_index=__webpack_require__(125),_app=__webpack_require__(624),_app2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_app),AppController=exports.AppController=function(){function AppController($log,$window,$ngRedux){"ngInject";_classCallCheck(this,AppController),this.log=$log,this.exporter=new _index.Exporter($window.document),this.codeExpanded=!0,this.unsubscribe=$ngRedux.connect(this.mapStateToThis)(this)}return _createClass(AppController,[{key:"$onDestroy",value:function(){this.unsubscribe()}},{key:"mapStateToThis",value:function(state){return{text:state.source,graph:state.graph,dot:state.dot}}},{key:"onExport",value:function(format,href){this.log.debug("Exporting as",format,href),this.exporter.export(format,this.graph.title,this.text,this.dot)}}]),AppController}();exports.name="c4LabApp",exports.options={template:_app2.default,controller:AppController}},624:function(module,exports){module.exports='<c4-lab-nav on-export="$ctrl.onExport(format, href)"></c4-lab-nav>\n<div class="container-fluid">\n    <div class="row">\n        <div ng-class="$ctrl.codeExpanded ? \'col-md-6\' : \'col-md-4\'">\n            <c4-lab-editor></c4-lab-editor>\n\n            <button class="btn btn-default btn-block" type="button" ng-click="$ctrl.codeExpanded = !$ctrl.codeExpanded">\n                <span class="glyphicon" ng-class="$ctrl.codeExpanded ? \'glyphicon-chevron-left\' : \'glyphicon-chevron-right\'"></span>\n                Show {{$ctrl.codeExpanded ? \'less\' : \'more\'}} code\n            </button>\n        </div>\n        <div ng-class="$ctrl.codeExpanded ? \'col-md-6\' : \'col-md-8\'">\n            <c4-lab-viewer></c4-lab-viewer>\n        </div>\n    </div>\n</div>'},625:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.options=exports.name=void 0;var _template=__webpack_require__(626),_template2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_template),BuildInfoController=function BuildInfoController(){_classCallCheck(this,BuildInfoController),this.version="0.35.0",this.build="111",this.hash="2a0cae3bfa570d5ac7460c2cd85f964ace884f37"};exports.name="c4LabBuildInfo",exports.options={template:_template2.default,controller:BuildInfoController}},626:function(module,exports){module.exports='<span class="text-muted small" title="{{$ctrl.hash}}">\n  v{{$ctrl.version}}+{{$ctrl.build}}\n</span>\n'},627:function(module,exports,__webpack_require__){"use strict";function configureRoutes($stateProvider,$urlRouterProvider){"ngInject";$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/?zoom",component:"c4LabApp",resolve:{zoom:function($stateParams){return $stateParams.zoom}},onEnter:function(zoom,$ngRedux){$ngRedux.getState().zoomNodeId!==zoom&&$ngRedux.dispatch((0,_actions.zoomChanged)({zoomNodeId:zoom}))}}).state("load",{url:"/load/{data}?zoom",component:"c4LabPreview",resolve:{encodedText:function($stateParams){return $stateParams.data},zoom:function($stateParams){return $stateParams.zoom}},onEnter:function(zoom,$ngRedux){$ngRedux.getState().zoomNodeId!==zoom&&$ngRedux.dispatch((0,_actions.zoomChanged)({zoomNodeId:zoom}))}}).state("help",{url:"/help",component:"c4LabHelp"})}Object.defineProperty(exports,"__esModule",{value:!0});var _actions=__webpack_require__(47);exports.default=configureRoutes},628:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}Object.defineProperty(exports,"__esModule",{value:!0});var _angular=__webpack_require__(42),angular=_interopRequireWildcard(_angular),_preview=__webpack_require__(629),previewComponent=_interopRequireWildcard(_preview),_header=__webpack_require__(280),_header2=_interopRequireDefault(_header),_viewer=__webpack_require__(286),_viewer2=_interopRequireDefault(_viewer);exports.default=angular.module("c4-lab.preview",[_header2.default,_viewer2.default]).component(previewComponent.name,previewComponent.options).name},629:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.options=exports.name=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_preview=__webpack_require__(630),_preview2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_preview),_index=__webpack_require__(125),PreviewComponent=function(){function PreviewComponent($window,$state){_classCallCheck(this,PreviewComponent),this.exporter=new _index.Exporter($window.document),this.storage=new _index.DataStore($window.localStorage),this.$state=$state}return _createClass(PreviewComponent,[{key:"$onChanges",value:function(){this.text=(0,_index.uriDecode)(this.encodedText),this.graph=(0,_index.parse)(this.text)}},{key:"onExport",value:function(format){this.exporter.export(format,this.graph.title,this.text,this.dot)}},{key:"edit",value:function(){this.storage.save(this.text),this.$state.go("home")}}]),PreviewComponent}();exports.name="c4LabPreview",exports.options={template:_preview2.default,controller:PreviewComponent,bindings:{zoom:"<",encodedText:"<"}}},630:function(module,exports){module.exports='<c4-lab-nav text="$ctrl.text" on-export="$ctrl.onExport(format)" zoom="$ctrl.zoom"></c4-lab-nav>\n<c4-lab-viewer graph="$ctrl.graph" zoom="$ctrl.zoom" ng-model="$ctrl.dot">\n    <button type="button" class="btn btn-primary hidden-xs hidden-sm" ng-click="$ctrl.edit()">Start editing this graph</button>\n</c4-lab-viewer>'},631:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.options=exports.name=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_viewer=__webpack_require__(632),_viewer2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_viewer),_actions=__webpack_require__(47),ViewerComponent=function(){function ViewerComponent($log,$sce,$ngRedux){"ngInject";_classCallCheck(this,ViewerComponent),this.$log=$log,this.$sce=$sce,this.unsubscribe=$ngRedux.connect(this.mapStateToThis.bind(this),{zoomChanged:_actions.zoomChanged})(this)}return _createClass(ViewerComponent,[{key:"$onDestroy",value:function(){this.unsubscribe()}},{key:"mapStateToThis",value:function(state){return{expandableNodes:state.zoomableNodes,graph:state.graph,zoom:state.zoomNodeId,dot:state.dot,svg:this.$sce.trustAsHtml(state.svg)}}},{key:"onZoom",value:function(){this.zoomChanged({zoomNodeId:this.zoom})}}]),ViewerComponent}();exports.name="c4LabViewer",exports.options={transclude:!0,template:_viewer2.default,controller:ViewerComponent}},632:function(module,exports){module.exports='<div>\n    <form class="form-inline">\n        <div class="form-group">\n            <label for="zoomableNodes">Zoom to node</label>\n            <select name="zoomableNodes" class="form-control" ng-model="$ctrl.zoom" ng-change="$ctrl.onZoom()">\n                <option ng-value="undefined">--none--</option>\n                <option ng-repeat="node in $ctrl.expandableNodes track by node.id"\n                    value="{{node.id}}">{{node.path}}</option>\n            </select>\n        </div>\n        <div class="form-group" ng-transclude>\n        </div>\n    </form>\n    <uib-tabset>\n        <uib-tab heading="svg">\n            <div ng-bind-html="$ctrl.svg"></div>\n        </uib-tab>\n        <uib-tab heading="dot">\n            <p>This is for debugging purposes</p>\n            \x3c!-- TODO: a disabled text area --\x3e\n            <pre>{{$ctrl.dot}}</pre>\n        </uib-tab>\n    </uib-tabset>\n    <div>'},633:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _angular=__webpack_require__(42),angular=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(_angular),_help=__webpack_require__(634),_help2=_interopRequireDefault(_help),_help3=__webpack_require__(635),_help4=_interopRequireDefault(_help3);__webpack_require__(636);var HelpController=function HelpController(){_classCallCheck(this,HelpController),this.content=_help4.default};exports.default=angular.module("c4-lab.help",["hc.marked"]).component("c4LabHelp",{template:_help2.default,controller:HelpController}).name},634:function(module,exports){module.exports='<c4-lab-nav></c4-lab-nav>\n<div marked="$ctrl.content"></div>'},635:function(module,exports){module.exports='# C4-Lab Help\n\nC4-Lab defines a domain specific language (DSL) for creating software\narchitectures, modeled heavily after [Simon Brown][SB]\'s [C4][] approach\n(Context, Containers, Components, and Classes). See [Visualising Software\nArchitecture][] for more information.\n\n[SB]: http://www.simonbrown.je/\n[C4]: http://www.codingthearchitecture.com/2014/08/24/c4_model_poster.html\n[Visualising Software Architecture]: https://leanpub.com/visualising-software-architecture\n\n## Features\n\nC4-Lab has import, export, and "share" features accessible in the top\nnavigation, and saves work-in-progress in your browser.  If you want to save a\ngraph for later editing, export the `sexp` format, or save the "share" link.\nOther exports do not allow resuming editing.\n\n## Syntax\n\nThe DSL uses [s-expression][]s to represent the hierarchy and connections\nbetween actors, systems, containers, and components. If you squint your eyes, it\nlooks like common lisp or scheme macros.\n\nWe use the excellent [CodeMirror][] in-browser editor to add syntax highlighting\nand some help with managing the parentheses.\n\n[CodeMirror]: https://codemirror.net/\n[s-expression]: https://en.wikipedia.org/wiki/S-expression\n\n### Full example\n\nHere\'s a small bit of software archicture for a web application, demonstrating\nsome of the syntax.\n\n    (define-actor ("customer")\n      (edge :to "dog rater" :description "views/votes/uploads dog pictures"))\n\n    (define-system ("dog rater" :desc "fun clickbait website")\n\n      (def-container ("frontend" :tech "typescript, reactjs")\n        (edge :to "./database" :desc "display sweet dog pictures" \n              :direction "both")\n        )\n\n      (def-container ("backend" :tech "golang")\n        (def-component ("ad provider")\n          (edge :to "third party ad network" :desc "fetch user-specific ads")\n          )\n        )\n\n      (def-container ("database" :tech "amazon S3"))\n    )\n\n    (def-system ("third party ad network" :desc "advert network"))\n\n### Actors\n\nTop level element, represents a human using the software.\n\nExamples:\n\n    (define-actor ("customer")\n      ;; optional edges to other parts of the architecture\n      )\n\nIf this were a real lisp macro, it\'s definition would look like:\n\n    (defmacro define-actor ((name) &body children))\n\n### Systems\n\nTop level element, represents a logical software system.\n\nExamples:\n\n    (define-system ("name of the system" :description "optional description" \n                                         :tech "optional technology")\n      ;; optional children of this system; edges or containers\n      )\n    (def-system ("name of the system" :desc "can abbreviate a little; :desc vs :description, def-system vs define-system"))\n\nIf this were a real lisp macro, it\'s definition would look like:\n\n    (defmacro define-system ((name) &key description tech &body children))\n\n### Containers\n\nContainers are independently deployable pieces of a system. They should be used as children of a `def-system`\n\nExamples:\n\n    (def-system ("dog ratr")\n      (def-container ("frontend" :tech "..." :desc "...")\n        ;; optional children of this system; edges or components\n      )\n    )\n\nIf this were a real lisp macro, it\'s definition would look like:\n\n    (defmacro define-container ((name) &key description tech &body children))\n\n### Components\n\nComponents are pieces of one deployable part of a system. These could be things\nlike java packages, C# assemblies, ES6 modules, etc. They should be used as\nchildren of a `def-container`\n\nExamples:\n\n    (def-system ("dog ratr")\n      (def-container ("frontend")\n        (def-component ("upload page" :tech "..." :desc "..."))\n        (def-component ("dog browser")\n          ;; optional children, edges\n        )\n      )\n    )\n\nIf this were a real lisp macro, it\'s definition would look like:\n\n    (defmacro define-component ((name) &key description tech &body children))\n\n### Edges\n\nEdges represent connections between the different elements in a software\narchitecture. These have a few different options for how to connect things.\nConnections are specified using something like a file path to unambiguously\nidentify the destination of an edge.\n\nThey can be used as children of `def-actor`, `def-system`, `def-container`, and\n`def-component`.\n\nYou can customize the direction of the edge using the `:direction` (`:dir` for\nshort) option. The valid options are:\n\n* `push` - (default), indicates this node is reaching out to the target. Draws\n  an arrow from the current node to the target.\n* `pull` - indicates this node is pulling from the target, e.g. as a subscriber.\n  Draws an arrow from the target to the current node.\n* `both` - indicates bidrectional flow of actions/information. Draws an arrow to\n  and from the target to the current node.\n\nExamples:\n\n    (def-actor ("customer")\n      ;; connect this actor to the dog ratr system, and describe\n      ;; how the actor uses the system\n      (edge :to "dog ratr" :desc "clicks a lot of links and ads"))\n\n    (def-system ("dog ratr")\n      (def-container ("frontend")\n        ;; connect the frontend to the backend, with a relative path\n        (edge :to "./backend" :desc "fetch list of dogs" :dir "both")\n        ;; can specify a "full" path to connect with nodes that aren\'t\n        ;; on the top level\n        (edge :to "ad server/click tracker" :desc "records a click via HTTP")\n      )\n      (def-container ("backend"))\n    )\n\n    (def-system ("ad server")\n      (def-container ("click tracker")))\n\nIf this were a real lisp function, it\'s definition would look like:\n\n    (defun edge (&key to description (direction "both")))\n\n### Comments\n\nComments are of questionable use since they don\'t show up in the diagrams at\nall, but they are useful for commenting out code while you\'re still hasing out\nthe architecture.\n\nAny content after two colons is ignored as a comment.\n\nExamples:\n\n    ;; this whole line is a comment\n    (def-system ("dog ratr")) ;; this bit is ignored, too\n'},639:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _angular=__webpack_require__(42),angular=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(_angular);__webpack_require__(640);var _reduxSaga=__webpack_require__(709),_reduxSaga2=_interopRequireDefault(_reduxSaga),_reducers=__webpack_require__(715),_reducers2=_interopRequireDefault(_reducers),_sagas=__webpack_require__(718),timingMiddleware=function(store){return function(next){return function(action){var label="Processing "+action.type;console.time(label),console.group(label);try{return next(action)}finally{console.timeEnd(label),console.groupEnd()}}}},enhancers=[],reduxDevtool=window.__REDUX_DEVTOOLS_EXTENSION__;reduxDevtool&&enhancers.push(reduxDevtool());var sagas=(0,_reduxSaga2.default)();exports.default=angular.module("c4-lab.store",["ngRedux"]).config(function($ngReduxProvider){$ngReduxProvider.createStoreWith(_reducers2.default,[timingMiddleware,sagas],enhancers)}).run(function($ngRedux){sagas.run(_sagas.rootSaga)}).name},715:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.initialState=void 0;var _redux=__webpack_require__(298),_typescriptFsaReducers=__webpack_require__(716),_actions=__webpack_require__(47),_c4lab=__webpack_require__(717),_c4lab2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_c4lab),sourceReducer=(exports.initialState={graph:null,parseError:null,source:_c4lab2.default,zoomNodeId:null,zoomableNodes:[]},(0,_typescriptFsaReducers.reducerWithInitialState)(_c4lab2.default).case(_actions.sourceChanged,function(old,evt){return evt.source}).build()),testSafeSourceReducer=function(src,evt){return sourceReducer(src,evt)||""},parseErrorReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.sourceParseError,function(old,evt){return evt.error}).case(_actions.sourceParsed,function(old,evt){return null}).build(),graphReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.sourceParsed,function(old,evt){return evt.graph}).build(),zoomableNodesReducer=(0,_typescriptFsaReducers.reducerWithInitialState)([]).case(_actions.sourceParsed,function(old,evt){return evt.graph.items.filter(function(x){return x.canExpand}).sort(function(a,b){return a.path.localeCompare(b.path)})}).build(),zoomNodeIdReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.zoomChanged,function(old,evt){return evt.zoomNodeId||null}).build(),dotReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.dotChanged,function(old,evt){return evt.dot}).build(),svgReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.svgChanged,function(old,evt){return evt.svg}).build(),stateReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.angularInitialized,function(old,evt){return evt.$state}).build(),windowReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.angularInitialized,function(old,evt){return evt.$window}).build(),userReducer=(0,_typescriptFsaReducers.reducerWithInitialState)(null).case(_actions.githubLoginComplete,function(old,evt){return evt}).case(_actions.githubLogout,function(old,evt){return null}).build(),rootReducer=(0,_redux.combineReducers)({$state:stateReducer,$window:windowReducer,dot:dotReducer,graph:graphReducer,parseError:parseErrorReducer,source:testSafeSourceReducer,svg:svgReducer,user:userReducer,zoomNodeId:zoomNodeIdReducer,zoomableNodes:zoomableNodesReducer});exports.default=rootReducer},717:function(module,exports){module.exports='(title "c4-lab")\n;; add an actor to represent humans that use your system\n(define-actor ("Devs")\n  ;; add edges to say what part of your system the actor uses\n  (edge\n   ;; specify where the other end of this edge is using something like a path\n   ;; "C4 Lab/UI" points at the "C4 Lab" system, the the "UI" container inside\n   :to "C4 Lab/UI"\n   :description "Create/read/update designs")\n  )\n;; add your system\n(define-system ("C4 Lab"\n                :description "Web-based rapid prototyping of C4 diagrams to augment whiteboards")\n  ;; add the containers inside your system\n  (def-container ("UI" :tech "html5, angularjs"\n                       :description "prototype, import, export C4 diagrams" ))\n  )\n(define-system ("Github" :description "Free git and web hosting")\n  ;; add edges between any actor, system, or container\n  (edge :description "hosts" :to "C4 Lab/UI")\n  (edge :to "Travis-ci" :description "triggers build")\n  )\n(define-system ("Travis-ci" :description "Open source CI")\n  (edge :to "Github" :description "publishes"))\n;; any line that starts with ";;" is a comment\n'},718:function(module,exports,__webpack_require__){"use strict";function onSourceChanged(action){var graph;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,graph=(0,_core.parse)(action.payload.source),_context.next=4,(0,_effects.put)((0,_actions.sourceParsed)({graph:graph}));case 4:_context.next=10;break;case 6:return _context.prev=6,_context.t0=_context.catch(0),_context.next=10,(0,_effects.put)((0,_actions.sourceParseError)({error:_context.t0.message}));case 10:case"end":return _context.stop()}},_marked,this,[[0,6]])}function hrefTo($state,zoom){var name=$state.current.name;if(void 0===name)return"";var params=Object.assign({},$state.params,{zoom:zoom});return $state.href(name,params)}function render(){var _ref,zoomNodeId,graph,$state,$window,source,dot,svg;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,(0,_effects.select)();case 2:_ref=_context2.sent,zoomNodeId=_ref.zoomNodeId,graph=_ref.graph,$state=_ref.$state,$window=_ref.$window,source=_ref.source,new _core.DataStore($window.localStorage).save(source);case 9:if($state.current&&$state.current.name){_context2.next=14;break}return _context2.next=12,(0,_effects.call)(wait);case 12:_context2.next=9;break;case 14:return dot=(0,_core.toDot)(graph,zoomNodeId,function(x){return hrefTo($state,x)}),_context2.next=17,(0,_effects.put)((0,_actions.dotChanged)({dot:dot}));case 17:return svg=(0,_core.toSvg)(dot),_context2.next=20,(0,_effects.put)((0,_actions.svgChanged)({svg:svg}));case 20:case"end":return _context2.stop()}},_marked2,this)}function wait(){var ms=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return new Promise(function(resolve){return setTimeout(resolve,ms)})}function updateZoom(action){var _ref2,$state,zoom,name,params;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,(0,_effects.select)();case 2:if(_ref2=_context3.sent,$state=_ref2.$state,(zoom=action.payload.zoomNodeId)!==$state.params.zoom){_context3.next=7;break}return _context3.abrupt("return");case 7:return _context3.next=9,(0,_effects.call)(render);case 9:name=$state.current.name,name&&(params=Object.assign({},$state.params,{zoom:zoom}),$state.go(name,params,{notify:!1}));case 11:case"end":return _context3.stop()}},_marked3,this)}function latestSource(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,(0,_effects.takeLatest)(_actions.sourceChanged,onSourceChanged);case 2:case"end":return _context4.stop()}},_marked4,this)}function latestGraph(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,(0,_effects.takeLatest)(_actions.sourceParsed,render);case 2:case"end":return _context5.stop()}},_marked5,this)}function latestZoom(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,(0,_effects.throttle)(100,_actions.zoomChanged,updateZoom);case 2:case"end":return _context6.stop()}},_marked6,this)}function init(){var _ref3,$window,storage,source;return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,(0,_effects.take)(_actions.angularInitialized.type);case 2:return _context7.next=4,(0,_effects.select)();case 4:if(_ref3=_context7.sent,$window=_ref3.$window,$window.localStorage){_context7.next=8;break}return _context7.abrupt("return");case 8:if(storage=new _core.DataStore($window.localStorage),!(source=storage.load())){_context7.next=13;break}return _context7.next=13,(0,_effects.put)((0,_actions.sourceChanged)({source:source}));case 13:case"end":return _context7.stop()}},_marked7,this)}function rootSaga(){return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,(0,_effects.all)([(0,_effects.call)(latestSource),(0,_effects.call)(latestGraph),(0,_effects.call)(latestZoom),(0,_effects.call)(init),(0,_effects.call)(_github2.default)]);case 2:case"end":return _context8.stop()}},_marked8,this)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.rootSaga=rootSaga;var _effects=__webpack_require__(193),_core=__webpack_require__(125),_actions=__webpack_require__(47),_github=__webpack_require__(719),_github2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_github),_marked=regeneratorRuntime.mark(onSourceChanged),_marked2=regeneratorRuntime.mark(render),_marked3=regeneratorRuntime.mark(updateZoom),_marked4=regeneratorRuntime.mark(latestSource),_marked5=regeneratorRuntime.mark(latestGraph),_marked6=regeneratorRuntime.mark(latestZoom),_marked7=regeneratorRuntime.mark(init),_marked8=regeneratorRuntime.mark(rootSaga)},719:function(module,exports,__webpack_require__){"use strict";function onGithubLogin(action){var user;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return octokit.authenticate({token:action.payload.token,type:"oauth"}),_context.next=3,(0,_effects.call)(function(){return octokit.users.get({})});case 3:return user=_context.sent,_context.next=6,(0,_effects.put)((0,_actions.githubLoginComplete)(Object.assign({},action.payload,{avatarUrl:user.data.avatar_url,login:user.data.login})));case 6:case"end":return _context.stop()}},_marked,this)}function exportToGist(action){var _window$location,origin,pathname,url,exporter,_ref,source,title,result;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _window$location=window.location,origin=_window$location.origin,pathname=_window$location.pathname,url=new URL(""+origin+pathname+action.payload.href),exporter=new _gist.GistExporter(octokit),_context2.next=5,(0,_effects.select)();case 5:return _ref=_context2.sent,source=_ref.source,title=_ref.graph.title,_context2.next=10,(0,_effects.call)(function(){return exporter.export(title,source,url)});case 10:return result=_context2.sent,_context2.next=13,(0,_effects.put)(_actions.gistExport.done(result));case 13:window.open(result.url,"_blank");case 14:case"end":return _context2.stop()}},_marked2,this)}function handleLogin(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,(0,_effects.takeLatest)(_actions.githubLoggedIn,onGithubLogin);case 2:case"end":return _context3.stop()}},_marked3,this)}function handleExport(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,(0,_effects.takeLatest)(_actions.gistExport.started,exportToGist);case 2:case"end":return _context4.stop()}},_marked4,this)}function githubSaga(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,(0,_effects.all)([(0,_effects.call)(handleLogin),(0,_effects.call)(handleExport)]);case 2:case"end":return _context5.stop()}},_marked5,this)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=githubSaga;var _rest=__webpack_require__(720),Octokit=function(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}(_rest),_effects=__webpack_require__(193),_gist=__webpack_require__(871),_actions=__webpack_require__(47),_marked=regeneratorRuntime.mark(onGithubLogin),_marked2=regeneratorRuntime.mark(exportToGist),_marked3=regeneratorRuntime.mark(handleLogin),_marked4=regeneratorRuntime.mark(handleExport),_marked5=regeneratorRuntime.mark(githubSaga),octokit=function(){try{return new Octokit}catch(e){}try{return Octokit.default()}catch(e){}throw new Error("I dunno, man")}()},784:function(module,exports){},871:function(module,exports,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function createReadme(title,url){return"# C4 Diagrams for *"+title+"*\n\nThese files were exported from [C4-Lab](https://ryepup.github.io/c4-lab)\n\n[View or edit these diagrams]("+url+")\n"}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.GistExporter=function(){function GistExporter(gh){_classCallCheck(this,GistExporter),this.gh=gh}return _createClass(GistExporter,[{key:"export",value:function(title,sexp,url){return this.gh.gists.create({description:"C4 diagrams for '"+title+"'",files:this.createFiles(title,url,sexp),public:!1}).then(function(resp){return{id:resp.data.id,url:new URL(resp.data.html_url)}})}},{key:"createFiles",value:function(title,url,sexp){return _defineProperty({"README.md":{content:createReadme(title,url)}},title+".sexp",{content:sexp})}}]),GistExporter}()}},[349]);
//# sourceMappingURL=main.a575ac7808f526898c7c.js.map